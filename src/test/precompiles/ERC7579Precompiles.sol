// SPDX-License-Identifier: MIT
pragma solidity >=0.8.24 <0.9.0;

// Interfaces
import { IERC7579Account } from "src/accounts/common/interfaces/IERC7579Account.sol";
import { IERC7579Bootstrap } from "src/accounts/erc7579/interfaces/IERC7579Bootstrap.sol";

// Utils
import { label } from "src/test/utils/Vm.sol";
import { BytecodeDeployer } from "./BytecodeDeployer.sol";

interface RhinestoneBootstrap {
    function init() external;
}

contract ERC7579Precompiles is BytecodeDeployer {
    /*//////////////////////////////////////////////////////////////
                                 DEPLOY
    //////////////////////////////////////////////////////////////*/

    function deployERC7579Account() internal returns (IERC7579Account) {
        return IERC7579Account(_deploy(ERC7579_BYTECODE));
    }

    function deployERC7579Bootstrap() internal returns (IERC7579Bootstrap) {
        return IERC7579Bootstrap(_deploy(ERC7579_BOOTSTRAP_BYTECODE));
    }

    function deployRhinestoneBootstrap() internal returns (RhinestoneBootstrap) {
        return RhinestoneBootstrap(_deploy(ERC7579_RHINESTONE_TRAMPOLOINE_BYTECODE));
    }

    /*//////////////////////////////////////////////////////////////
                            BYTECODES
    //////////////////////////////////////////////////////////////*/

    bytes constant ERC7579_BYTECODE =
        hex"6080604052348015600e575f5ffd5b5061387a8061001c5f395ff3fe60806040526004361061010c575f3560e01c8063a71763a811610094578063e9ae5c5311610063578063e9ae5c5314610438578063ea5f61d01461044b578063eab77e171461046a578063eac9b20d14610489578063f2dc691d146104d657610113565b8063a71763a8146103c4578063b0d691fe146103d7578063d03c7914146103f9578063d691c9641461041857610113565b80634b6a1419116100db5780634b6a1419146103135780635faac46b146103265780638dd7712f146103535780639517e29f146103665780639cfd7cff1461037957610113565b80630a664dba1461025a578063112d3a7d1461028b5780631626ba7e146102ba57806319822f7c146102f257610113565b3661011357005b5f3560e01c63bc197c81811463f23a6e6182141763150b7a028214171561013e57806020526020603cf35b505f6101486104f5565b5f80356001600160e01b03191681526002919091016020526040902080549091506001600160a01b03811690600160a01b900460f81b816101ae57604051632464e76d60e11b81526001600160e01b03195f351660048201526024015b60405180910390fd5b6101bc81607f60f91b610519565b1561020d5760408051368101909152365f823760408051601481019091523360601b90525f803660140183865afa90506101fc3d60408051918201905290565b3d5f823e81610209573d81fd5b3d81f35b610217815f610519565b156102585760408051368101909152365f823760408051601481019091523360601b90525f80366014018382875af190506101fc3d60408051918201905290565b005b348015610265575f5ffd5b5061026e610530565b6040516001600160a01b0390911681526020015b60405180910390f35b348015610296575f5ffd5b506102aa6102a5366004612d4c565b61054b565b6040519015158152602001610282565b3480156102c5575f5ffd5b506102d96102d4366004612da3565b6105ae565b6040516001600160e01b03199091168152602001610282565b610305610300366004612ecf565b610681565b604051908152602001610282565b610258610321366004613003565b610891565b348015610331575f5ffd5b50610345610340366004613041565b61091d565b60405161028292919061306b565b6102586103613660046130cd565b610943565b610258610374366004612d4c565b610a0e565b348015610384575f5ffd5b50604080518082018252601b81527f754d53412e616476616e6365642f77697468486f6f6b2e76302e310000000000602082015290516102829190613133565b6102586103d2366004612d4c565b610ea1565b3480156103e2575f5ffd5b506f71727de22e5e9d8baf0edac6f37da03261026e565b348015610404575f5ffd5b506102aa610413366004613145565b611106565b61042b610426366004612da3565b6111a1565b604051610282919061315c565b610258610446366004612da3565b61189f565b348015610456575f5ffd5b50610345610465366004613041565b611ccc565b348015610475575f5ffd5b506102586104843660046131bf565b611ce8565b348015610494575f5ffd5b506104a86104a336600461326d565b611da5565b6040805182516001600160a01b031681526020928301516001600160f81b0319169281019290925201610282565b3480156104e1575f5ffd5b506102aa6104f0366004613145565b611e12565b7ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea0290565b6001600160f81b0319828116908216145b92915050565b5f6105465f5160206137f45f395f51905f525490565b905090565b5f600185036105645761055d84611e5f565b90506105a6565b600285036105755761055d84611e7c565b600385036105925761055d61058c8385018561326d565b85611e95565b600485036105a35761055d84611ed1565b505f5b949350505050565b5f806105bd6014828587613288565b6105c6916132af565b60601c90506105d481611e5f565b6105fc57604051635c93ff2f60e11b81526001600160a01b03821660048201526024016101a5565b6001600160a01b03811663f551e2ee338761061a876014818b613288565b6040518563ffffffff1660e01b81526004016106399493929190613324565b602060405180830381865afa158015610654573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906106789190613355565b95945050505050565b5f336f71727de22e5e9d8baf0edac6f37da032146106b257604051635629665f60e11b815260040160405180910390fd5b60208401518290606081901c906106c882611e5f565b610806576106d4611f01565b6107fb575f5f5f8961010001518060200190518101906106f491906133bd565b9250925092505f5f848060200190518101906107109190613448565b915091505f61071f8383611f2d565b90505f610759610753836020527b19457468657265756d205369676e6564204d6573736167653a0a33325f52603c60042090565b87611fb0565b90506001600160a01b038116301461077d5760019a50505050505050505050610879565b61078561203b565b5f846001600160a01b03168460405161079e91906134ac565b5f60405180830381855af49150503d805f81146107d6576040519150601f19603f3d011682016040523d82523d5f602084013e6107db565b606091505b50509050806107e8575f5ffd5b50505050506101008a0152506108069050565b600193505050610879565b604051639700320360e01b81526001600160a01b03831690639700320390610834908a908a906004016134b7565b6020604051808303815f875af1158015610850573d5f5f3e3d5ffd5b505050506040513d601f19601f820116820180604052508101906108749190613583565b935050505b8015610889575f385f3884335af1505b509392505050565b61089961205e565b6108a161203b565b5f806108af8385018561359a565b915091505f826001600160a01b0316826040516108cc91906134ac565b5f60405180830381855af49150503d805f8114610904576040519150601f19603f3d011682016040523d82523d5f602084013e610909565b606091505b5050905080610916575f5ffd5b5050505050565b60605f5f6109296104f5565b90506109368186866120a3565b92509250505b9250929050565b336f71727de22e5e9d8baf0edac6f37da0321461097357604051635629665f60e11b815260040160405180910390fd5b365f61098260608501856135dc565b610990916004908290613288565b915091505f306001600160a01b031683836040516109af92919061361e565b5f60405180830381855af49150503d805f81146109e7576040519150601f19603f3d011682016040523d82523d5f602084013e6109ec565b606091505b505090508061091657604051632b3f6d1160e21b815260040160405180910390fd5b336f71727de22e5e9d8baf0edac6f37da0321480610a2b57503330145b610a4857604051635629665f60e11b815260040160405180910390fd5b5f610a5e5f5160206137f45f395f51905f525490565b90506001600160a01b038116610c1d575f54849086906001600160a01b03168015610ae0576040516396fb721760e01b81526001600160a01b038481166004830152602482018490528216906396fb7217906044015f6040518083038186803b158015610ac9575f5ffd5b505afa158015610adb573d5f5f3e3d5ffd5b505050505b60405163ecd0596160e01b8152600481018990526001600160a01b0388169063ecd0596190602401602060405180830381865afa158015610b23573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610b47919061362d565b610b67576040516369c9a24560e11b8152600481018990526024016101a5565b60018803610b7f57610b7a87878761224a565b610bd4565b60028803610b9257610b7a87878761228d565b60038803610ba557610b7a8787876122a5565b60048803610bb857610b7a878787612423565b60405163041c38b360e41b8152600481018990526024016101a5565b604080518981526001600160a01b03891660208201527fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef123910160405180910390a1505050610916565b60405163d68f602560e01b81525f906001600160a01b0383169063d68f602590610c51903390349086903690600401613324565b5f604051808303815f875af1158015610c6c573d5f5f3e3d5ffd5b505050506040513d5f823e601f3d908101601f19168201604052610c93919081019061364c565b5f54909150859087906001600160a01b03168015610d08576040516396fb721760e01b81526001600160a01b038481166004830152602482018490528216906396fb7217906044015f6040518083038186803b158015610cf1575f5ffd5b505afa158015610d03573d5f5f3e3d5ffd5b505050505b60405163ecd0596160e01b8152600481018a90526001600160a01b0389169063ecd0596190602401602060405180830381865afa158015610d4b573d5f5f3e3d5ffd5b505050506040513d601f19601f82011682018060405250810190610d6f919061362d565b610d8f576040516369c9a24560e11b8152600481018a90526024016101a5565b60018903610da757610da288888861224a565b610dfc565b60028903610dba57610da288888861228d565b60038903610dcd57610da28888886122a5565b60048903610de057610da2888888612423565b60405163041c38b360e41b8152600481018a90526024016101a5565b604080518a81526001600160a01b038a1660208201527fd21d0b289f126c4b473ea641963e766833c2f13866e4ff480abd787c100ef123910160405180910390a15050604051630b9dfbed60e11b81526001600160a01b038416915063173bf7da90610e6c908490600401613133565b5f604051808303815f87803b158015610e83575f5ffd5b505af1158015610e95573d5f5f3e3d5ffd5b50505050505050505050565b336f71727de22e5e9d8baf0edac6f37da0321480610ebe57503330145b610edb57604051635629665f60e11b815260040160405180910390fd5b5f610ef15f5160206137f45f395f51905f525490565b90506001600160a01b038116610fb45760018503610f1957610f14848484612483565b610f6e565b60028503610f2c57610f148484846124d8565b60038503610f3f57610f148484846124f4565b60048503610f5257610f148484846126f9565b60405163041c38b360e41b8152600481018690526024016101a5565b604080518681526001600160a01b03861660208201527f341347516a9de374859dfda710fa4828b2d48cb57d4fbe4c1149612b8e02276e910160405180910390a1610916565b60405163d68f602560e01b81525f906001600160a01b0383169063d68f602590610fe8903390349086903690600401613324565b5f604051808303815f875af1158015611003573d5f5f3e3d5ffd5b505050506040513d5f823e601f3d908101601f1916820160405261102a919081019061364c565b9050600186036110445761103f858585612483565b611099565b600286036110575761103f8585856124d8565b6003860361106a5761103f8585856124f4565b6004860361107d5761103f8585856126f9565b60405163041c38b360e41b8152600481018790526024016101a5565b604080518781526001600160a01b03871660208201527f341347516a9de374859dfda710fa4828b2d48cb57d4fbe4c1149612b8e02276e910160405180910390a1604051630b9dfbed60e11b81526001600160a01b0383169063173bf7da90610e6c908490600401613133565b5f81600881901b61111b82600160f81b610519565b15611129576001925061116a565b611133825f610519565b15611141576001925061116a565b611153826001600160f81b0319610519565b15611161576001925061116a565b505f9392505050565b611174815f610519565b15611182576001925061119a565b61119081600160f81b610519565b1561116157600192505b5050919050565b60605f6111ac6104f5565b60010190506111bb813361276e565b6111da57604051635c93ff2f60e11b81523360048201526024016101a5565b5f6111f05f5160206137f45f395f51905f525490565b90506001600160a01b038116611520575f5433906002906001600160a01b03168015611273576040516396fb721760e01b81526001600160a01b038481166004830152602482018490528216906396fb7217906044015f6040518083038186803b15801561125c575f5ffd5b505afa15801561126e573d5f5f3e3d5ffd5b505050505b88600881901b61128782600160f81b610519565b156112f55789358a016020810190356112a0835f610519565b156112b6576112af82826127a6565b99506112ee565b6112c483600160f81b610519565b156112d3576112af828261287d565b826040516308c3ee0360e11b81526004016101a5919061367d565b5050611516565b6112ff825f610519565b15611446575f5f365f6113128e8e6129a8565b6040805160018082528183019092529498509296509094509250816020015b6060815260200190600190039081611331579050509b505f6113538682610519565b1561138657611364858585856129f8565b8d5f8151811061137657611376613692565b602002602001018190525061143c565b61139486600160f81b610519565b15611421576113a585858585612a2b565b8e5f815181106113b7576113b7613692565b602090810291909101015290508061141c577fe723f28f104e46b47fd3531f3608374ac226bcf3ddda334a23a266453e0efdb75f8e5f815181106113fd576113fd613692565b60200260200101516040516114139291906136a6565b60405180910390a15b61143c565b856040516308c3ee0360e11b81526004016101a5919061367d565b5050505050611516565b611458826001600160f81b0319610519565b156114fb575f61146b6014828c8e613288565b611474916132af565b60601c9050365f8c8c601490809261148e93929190613288565b909250905061149d845f610519565b156114b3576114ad838383612a59565b506114f3565b6114c184600160f81b610519565b156114d8576114d1838383612a8a565b50506114f3565b836040516308c3ee0360e11b81526004016101a5919061367d565b505050611516565b81604051632e5bf3f960e21b81526004016101a5919061367d565b5050505050611896565b60405163d68f602560e01b81525f906001600160a01b0383169063d68f602590611554903390349086903690600401613324565b5f604051808303815f875af115801561156f573d5f5f3e3d5ffd5b505050506040513d5f823e601f3d908101601f19168201604052611596919081019061364c565b5f5490915033906002906001600160a01b0316801561160c576040516396fb721760e01b81526001600160a01b038481166004830152602482018490528216906396fb7217906044015f6040518083038186803b1580156115f5575f5ffd5b505afa158015611607573d5f5f3e3d5ffd5b505050505b89600881901b61162082600160f81b610519565b15611673578a358b01602081019035611639835f610519565b1561164f5761164882826127a6565b9a5061166c565b61165d83600160f81b610519565b156112d357611648828261287d565b5050611836565b61167d825f610519565b156117a4575f5f365f6116908f8f6129a8565b6040805160018082528183019092529498509296509094509250816020015b60608152602001906001900390816116af579050509c505f6116d18682610519565b15611704576116e2858585856129f8565b8e5f815181106116f4576116f4613692565b602002602001018190525061179a565b61171286600160f81b610519565b156114215761172385858585612a2b565b8f5f8151811061173557611735613692565b602090810291909101015290508061179a577fe723f28f104e46b47fd3531f3608374ac226bcf3ddda334a23a266453e0efdb75f8f5f8151811061177b5761177b613692565b60200260200101516040516117919291906136a6565b60405180910390a15b5050505050611836565b6117b6826001600160f81b0319610519565b156114fb575f6117c96014828d8f613288565b6117d2916132af565b60601c9050365f8d8d60149080926117ec93929190613288565b90925090506117fb845f610519565b156118115761180b838383612a59565b50611832565b61181f84600160f81b610519565b156114d85761182f838383612a8a565b50505b5050505b5050604051630b9dfbed60e11b81526001600160a01b038616935063173bf7da925061186791508490600401613133565b5f604051808303815f87803b15801561187e575f5ffd5b505af1158015611890573d5f5f3e3d5ffd5b50505050505b50509392505050565b336f71727de22e5e9d8baf0edac6f37da03214806118bc57503330145b6118d957604051635629665f60e11b815260040160405180910390fd5b5f6118ef5f5160206137f45f395f51905f525490565b90506001600160a01b038116611a8b5783600881901b61191382600160f81b610519565b15611965578435850160208101903561192c835f610519565b156119415761193b82826127a6565b5061195e565b61194f83600160f81b610519565b156112d35761193b828261287d565b5050611a84565b61196f825f610519565b156119f8575f5f365f61198289896129a8565b9350935093509350611997855f60f81b610519565b156119ae576119a8848484846129f8565b506119ef565b6119bc85600160f81b610519565b156119d4576119cd84848484612a2b565b50506119ef565b846040516308c3ee0360e11b81526004016101a5919061367d565b50505050611a84565b611a0a826001600160f81b0319610519565b156114fb575f611a1d6014828789613288565b611a26916132af565b60601c9050365f611a3a876014818b613288565b9092509050611a49845f610519565b15611a5f57611a59838383612a59565b50611a80565b611a6d84600160f81b610519565b156114d857611a7d838383612a8a565b50505b5050505b5050611cc6565b60405163d68f602560e01b81525f906001600160a01b0383169063d68f602590611abf903390349086903690600401613324565b5f604051808303815f875af1158015611ada573d5f5f3e3d5ffd5b505050506040513d5f823e601f3d908101601f19168201604052611b01919081019061364c565b905084600881901b611b1782600160f81b610519565b15611b695785358601602081019035611b30835f610519565b15611b4557611b3f82826127a6565b50611b62565b611b5383600160f81b610519565b156112d357611b3f828261287d565b5050611c69565b611b73825f610519565b15611bdd575f5f365f611b868a8a6129a8565b9350935093509350611b9b855f60f81b610519565b15611bb257611bac848484846129f8565b50611bd4565b611bc085600160f81b610519565b156119d457611bd184848484612a2b565b50505b50505050611c69565b611bef826001600160f81b0319610519565b156114fb575f611c02601482888a613288565b611c0b916132af565b60601c9050365f611c1f886014818c613288565b9092509050611c2e845f610519565b15611c4457611c3e838383612a59565b50611c65565b611c5284600160f81b610519565b156114d857611c62838383612a8a565b50505b5050505b5050604051630b9dfbed60e11b81526001600160a01b0383169063173bf7da90611c97908490600401613133565b5f604051808303815f87803b158015611cae575f5ffd5b505af1158015611cc0573d5f5f3e3d5ffd5b50505050505b50505050565b60605f5f611cd86104f5565b60010190506109368186866120a3565b336f71727de22e5e9d8baf0edac6f37da0321480611d0557503330145b611d2257604051635629665f60e11b815260040160405180910390fd5b5f80546001600160a01b0319166001600160a01b0386161790558115611cc65760405163f05c04e160e01b81526001600160a01b0385169063f05c04e190611d72908490879087906004016136be565b5f604051808303815f87803b158015611d89575f5ffd5b505af1158015611d9b573d5f5f3e3d5ffd5b5050505050505050565b604080518082019091525f8082526020820152611dc06104f5565b6001600160e01b0319929092165f908152600290920160209081526040928390208351808501909452546001600160a01b0381168452600160a01b900460f81b6001600160f81b031916908301525090565b5f60018203611e2357506001919050565b60028203611e3357506001919050565b60038203611e4357506001919050565b60048203611e5357506001919050565b505f919050565b919050565b5f5f611e696104f5565b9050611e75818461276e565b9392505050565b5f5f611e866104f5565b6001019050611e75818461276e565b5f5f611e9f6104f5565b6001600160e01b0319949094165f908152600290940160205250506040909120546001600160a01b0390811691161490565b5f816001600160a01b0316611ef15f5160206137f45f395f51905f525490565b6001600160a01b03161492915050565b5f5f611f0b6104f5565b60015f90815260209190915260409020546001600160a01b0316151592915050565b5f60405180606001604052806031815260200161381460319139604051602001611f5791906134ac565b60408051808303601f190181528282528051602091820120855186830120918401526001600160a01b03861691830191909152606082015260800160405160208183030381529060405280519060200120905092915050565b604051600190835f5260208301516040526040835103611feb57604083015160ff81901c601b016020526001600160ff1b031660605261200f565b604183510361200b5760608301515f1a602052604083015160605261200f565b5f91505b6020600160805f855afa5191503d61202e57638baa579f5f526004601cfd5b5f60605260405292915050565b5f6120446104f5565b905061205281600101612ab6565b61205b81612ab6565b50565b7f15839c8259ca8706cafa7ed5f198b3de1472c96ca2900b32a679090cc8a614de805c8061209f5760405163aed5959560e01b815260040160405180910390fd5b5050565b60605f6001600160a01b0384166001148015906120c757506120c5858561276e565b155b156120f057604051637c84ecfb60e01b81526001600160a01b03851660048201526024016101a5565b825f036121105760405163f725081760e01b815260040160405180910390fd5b826001600160401b0381111561212857612128612dea565b604051908082528060200260200182016040528015612151578160200160208202803683370190505b506001600160a01b038086165f90815260208890526040812054929450911691505b6001600160a01b0382161580159061219557506001600160a01b038216600114155b80156121a057508381105b156121f957818382815181106121b8576121b8613692565b6001600160a01b039283166020918202929092018101919091529281165f9081529287905260409092205490911690806121f181613729565b915050612173565b6001600160a01b03821660011480159061221257505f81115b1561223e5782612223600183613741565b8151811061223357612233613692565b602002602001015191505b80835250935093915050565b5f6122536104f5565b905061225f8185612b11565b6040516306d61fe760e41b81526001600160a01b03851690636d61fe7090611d729086908690600401613754565b5f6122966104f5565b600101905061225f8185612b11565b5f6122b36004828486613288565b6122bc91613767565b90505f838360048181106122d2576122d2613692565b909101356001600160f81b03191691505f90506122f28460058188613288565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f920191909152509293506123349250859150612be59050565b156123815760405162461bcd60e51b815260206004820152601e60248201527f46756e6374696f6e2073656c6563746f7220616c72656164792075736564000060448201526064016101a5565b604080518082019091526001600160a01b03871681526001600160f81b0319831660208201526123af6104f5565b6001600160e01b031985165f908152600291909101602090815260409182902083518154949092015160f81c600160a01b026001600160a81b03199094166001600160a01b039283161793909317909255516306d61fe760e41b815290871690636d61fe7090610e6c908490600401613133565b5f6124395f5160206137f45f395f51905f525490565b90506001600160a01b0381161561246e5760405163741cbe0360e01b81526001600160a01b03821660048201526024016101a5565b61225f845f5160206137f45f395f51905f5255565b5f61248c6104f5565b90505f8061249c8486018661359a565b90925090506124ac838388612c1d565b604051638a91b0e360e01b81526001600160a01b03871690638a91b0e390610e6c908490600401613133565b5f6124e16104f5565b60010190505f8061249c8486018661359a565b5f6125026004828486613288565b61250b91613767565b90505f61251b8360048187613288565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f9201919091525092935061255d9250849150612be59050565b6125a95760405162461bcd60e51b815260206004820152601a60248201527f46756e6374696f6e2073656c6563746f72206e6f74207573656400000000000060448201526064016101a5565b5f6125b26104f5565b6001600160e01b031984165f90815260029190910160209081526040918290208251808401909352546001600160a01b03808216808552600160a01b90920460f81b6001600160f81b0319169284019290925291925087161461266a5760405162461bcd60e51b815260206004820152602a60248201527f46756e6374696f6e2073656c6563746f72206e6f74207573656420627920746860448201526934b9903430b7323632b960b11b60648201526084016101a5565b604080518082019091525f80825260208201526126856104f5565b6001600160e01b031985165f908152600291909101602090815260409182902083518154949092015160f81c600160a01b026001600160a81b03199094166001600160a01b03928316179390931790925551638a91b0e360e01b815290871690638a91b0e390610e6c908590600401613133565b61270e5f5f5160206137f45f395f51905f5255565b604051638a91b0e360e01b81526001600160a01b03841690638a91b0e39061273c9085908590600401613754565b5f604051808303815f87803b158015612753575f5ffd5b505af1158015612765573d5f5f3e3d5ffd5b50505050505050565b5f60016001600160a01b03831614801590611e755750506001600160a01b039081165f90815260209290925260409091205416151590565b606081806001600160401b038111156127c1576127c1612dea565b6040519080825280602002602001820160405280156127f457816020015b60608152602001906001900390816127df5790505b5091505f5b81811015612875573685858381811061281457612814613692565b9050602002810190612826919061379d565b905061284f61283860208301836137bb565b602083013561284a60408501856135dc565b6129f8565b84838151811061286157612861613692565b6020908102919091010152506001016127f9565b505092915050565b606081806001600160401b0381111561289857612898612dea565b6040519080825280602002602001820160405280156128cb57816020015b60608152602001906001900390816128b65790505b5091505f5b8181101561287557368585838181106128eb576128eb613692565b90506020028101906128fd919061379d565b90505f61292761291060208401846137bb565b602084013561292260408601866135dc565b612a2b565b86858151811061293957612939613692565b602090810291909101015290508061299e577fe723f28f104e46b47fd3531f3608374ac226bcf3ddda334a23a266453e0efdb78386858151811061297f5761297f613692565b60200260200101516040516129959291906136a6565b60405180910390a15b50506001016128d0565b5f8036816129b96014828789613288565b6129c2916132af565b60601c93506129d5603460148789613288565b6129de916137d6565b92506129ed8560348189613288565b949793965094505050565b604051818382375f38838387895af1612a13573d5f823e3d81fd5b3d8152602081013d5f823e3d01604052949350505050565b6040515f90828482375f388483888a5af191503d8152602081013d5f823e3d81016040525094509492505050565b604051818382375f388383875af4612a73573d5f823e3d81fd5b3d8152602081013d5f823e3d016040529392505050565b6040515f90828482375f388483885af491503d8152602081013d5f823e3d810160405250935093915050565b60015f908152602082905260409020546001600160a01b031615612aed576040516329e42f3360e11b815260040160405180910390fd5b60015f818152602092909252604090912080546001600160a01b0319169091179055565b6001600160a01b0381161580612b3057506001600160a01b0381166001145b15612b5957604051637c84ecfb60e01b81526001600160a01b03821660048201526024016101a5565b6001600160a01b038181165f908152602084905260409020541615612b9c57604051631034f46960e21b81526001600160a01b03821660048201526024016101a5565b60015f818152602093909352604080842080546001600160a01b039485168087529286208054959091166001600160a01b03199586161790559190935280549091169091179055565b5f5f612bef6104f5565b6001600160e01b03199093165f908152600293909301602052505060409020546001600160a01b0316151590565b6001600160a01b0381161580612c3c57506001600160a01b0381166001145b15612c6557604051637c84ecfb60e01b81526001600160a01b03831660048201526024016101a5565b6001600160a01b038281165f90815260208590526040902054811690821614612cac57604051637c84ecfb60e01b81526001600160a01b03821660048201526024016101a5565b6001600160a01b039081165f8181526020949094526040808520805494841686529085208054949093166001600160a01b0319948516179092559092528154169055565b6001600160a01b038116811461205b575f5ffd5b8035611e5a81612cf0565b5f5f83601f840112612d1f575f5ffd5b5081356001600160401b03811115612d35575f5ffd5b60208301915083602082850101111561093c575f5ffd5b5f5f5f5f60608587031215612d5f575f5ffd5b843593506020850135612d7181612cf0565b925060408501356001600160401b03811115612d8b575f5ffd5b612d9787828801612d0f565b95989497509550505050565b5f5f5f60408486031215612db5575f5ffd5b8335925060208401356001600160401b03811115612dd1575f5ffd5b612ddd86828701612d0f565b9497909650939450505050565b634e487b7160e01b5f52604160045260245ffd5b60405161012081016001600160401b0381118282101715612e2157612e21612dea565b60405290565b604051601f8201601f191681016001600160401b0381118282101715612e4f57612e4f612dea565b604052919050565b5f6001600160401b03821115612e6f57612e6f612dea565b50601f01601f191660200190565b5f82601f830112612e8c575f5ffd5b8135612e9f612e9a82612e57565b612e27565b818152846020838601011115612eb3575f5ffd5b816020850160208301375f918101602001919091529392505050565b5f5f5f60608486031215612ee1575f5ffd5b83356001600160401b03811115612ef6575f5ffd5b84016101208187031215612f08575f5ffd5b612f10612dfe565b612f1982612d04565b81526020828101359082015260408201356001600160401b03811115612f3d575f5ffd5b612f4988828501612e7d565b60408301525060608201356001600160401b03811115612f67575f5ffd5b612f7388828501612e7d565b6060830152506080828101359082015260a0808301359082015260c0808301359082015260e08201356001600160401b03811115612faf575f5ffd5b612fbb88828501612e7d565b60e0830152506101008201356001600160401b03811115612fda575f5ffd5b612fe688828501612e7d565b610100830152509660208601359650604090950135949350505050565b5f5f60208385031215613014575f5ffd5b82356001600160401b03811115613029575f5ffd5b61303585828601612d0f565b90969095509350505050565b5f5f60408385031215613052575f5ffd5b823561305d81612cf0565b946020939093013593505050565b604080825283519082018190525f9060208501906060840190835b818110156130ad5783516001600160a01b0316835260209384019390920191600101613086565b50506001600160a01b039490941660209390930192909252509092915050565b5f5f604083850312156130de575f5ffd5b82356001600160401b038111156130f3575f5ffd5b8301610120818603121561305d575f5ffd5b5f81518084528060208401602086015e5f602082860101526020601f19601f83011685010191505092915050565b602081525f611e756020830184613105565b5f60208284031215613155575f5ffd5b5035919050565b5f602082016020835280845180835260408501915060408160051b8601019250602086015f5b828110156131b357603f1987860301845261319e858351613105565b94506020938401939190910190600101613182565b50929695505050505050565b5f5f5f5f606085870312156131d2575f5ffd5b84356131dd81612cf0565b935060208501356001600160401b038111156131f7575f5ffd5b8501601f81018713613207575f5ffd5b80356001600160401b0381111561321c575f5ffd5b8760208260051b8401011115613230575f5ffd5b60209190910193509150604085013560ff8116811461324d575f5ffd5b939692955090935050565b6001600160e01b03198116811461205b575f5ffd5b5f6020828403121561327d575f5ffd5b8135611e7581613258565b5f5f85851115613296575f5ffd5b838611156132a2575f5ffd5b5050820193919092039150565b80356bffffffffffffffffffffffff1981169060148410156132f5576bffffffffffffffffffffffff196bffffffffffffffffffffffff198560140360031b1b82161691505b5092915050565b81835281816020850137505f828201602090810191909152601f909101601f19169091010190565b60018060a01b0385168152836020820152606060408201525f61334b6060830184866132fc565b9695505050505050565b5f60208284031215613365575f5ffd5b8151611e7581613258565b5f82601f83011261337f575f5ffd5b815161338d612e9a82612e57565b8181528460208386010111156133a1575f5ffd5b8160208501602083015e5f918101602001919091529392505050565b5f5f5f606084860312156133cf575f5ffd5b83516001600160401b038111156133e4575f5ffd5b6133f086828701613370565b93505060208401516001600160401b0381111561340b575f5ffd5b61341786828701613370565b92505060408401516001600160401b03811115613432575f5ffd5b61343e86828701613370565b9150509250925092565b5f5f60408385031215613459575f5ffd5b825161346481612cf0565b60208401519092506001600160401b0381111561347f575f5ffd5b61348b85828601613370565b9150509250929050565b5f81518060208401855e5f93019283525090919050565b5f611e758284613495565b604081526134d16040820184516001600160a01b03169052565b602083015160608201525f604084015161012060808401526134f7610160840182613105565b90506060850151603f198483030160a08501526135148282613105565b915050608085015160c084015260a085015160e084015260c085015161010084015260e0850151603f19848303016101208501526135528282613105565b915050610100850151603f19848303016101408501526135728282613105565b925050508260208301529392505050565b5f60208284031215613593575f5ffd5b5051919050565b5f5f604083850312156135ab575f5ffd5b82356135b681612cf0565b915060208301356001600160401b038111156135d0575f5ffd5b61348b85828601612e7d565b5f5f8335601e198436030181126135f1575f5ffd5b8301803591506001600160401b0382111561360a575f5ffd5b60200191503681900382131561093c575f5ffd5b818382375f9101908152919050565b5f6020828403121561363d575f5ffd5b81518015158114611e75575f5ffd5b5f6020828403121561365c575f5ffd5b81516001600160401b03811115613671575f5ffd5b6105a684828501613370565b6001600160f81b031991909116815260200190565b634e487b7160e01b5f52603260045260245ffd5b828152604060208201525f6105a66040830184613105565b60ff8416815260406020820181905281018290525f8360608301825b8581101561370a5782356136ed81612cf0565b6001600160a01b03168252602092830192909101906001016136da565b509695505050505050565b634e487b7160e01b5f52601160045260245ffd5b5f6001820161373a5761373a613715565b5060010190565b8181038181111561052a5761052a613715565b602081525f6105a66020830184866132fc565b80356001600160e01b031981169060048410156132f5576001600160e01b031960049490940360031b84901b1690921692915050565b5f8235605e198336030181126137b1575f5ffd5b9190910192915050565b5f602082840312156137cb575f5ffd5b8135611e7581612cf0565b8035602083101561052a575f19602084900360031b1b169291505056fe36e05829dd1b9a4411d96a3549582172d7f071c1c0db5c573fcf94eb284316085369676e6564496e6974286164647265737320626f6f7473747261702c627974657320626f6f747374726170496e697429a2646970667358221220e83e3381e4a3a01b6e4061c5e74a9174afdce384fd5b72cbf6e35c1dd5e9d02564736f6c634300081b0033";
    bytes constant ERC7579_BOOTSTRAP_BYTECODE =
        hex"6080604052348015600e575f5ffd5b506112a48061001c5f395ff3fe60806040526004361061007e575f3560e01c80636b0d5cc41161004d5780636b0d5cc414610271578063b0d691fe14610290578063ea5f61d0146102b2578063eac9b20d146102d157610085565b80630a664dba146101c85780635e87556d146101f95780635faac46b14610225578063642219af1461025257610085565b3661008557005b5f3560e01c63bc197c81811463f23a6e6182141763150b7a02821417156100b057806020526020603cf35b505f80356001600160e01b03191681525f51602061124f5f395f51905f526020526040902080546001600160a01b03811690600160a01b900460f81b8161011c57604051632464e76d60e11b81526001600160e01b03195f351660048201526024015b60405180910390fd5b61012a81607f60f91b610384565b1561017b5760408051368101909152365f823760408051601481019091523360601b90525f803660140183865afa905061016a3d60408051918201905290565b3d5f823e81610177573d81fd5b3d81f35b610185815f610384565b156101c65760408051368101909152365f823760408051601481019091523360601b90525f80366014018382875af1905061016a3d60408051918201905290565b005b3480156101d3575f5ffd5b506101dc61039b565b6040516001600160a01b0390911681526020015b60405180910390f35b348015610204575f5ffd5b50610218610213366004610d11565b6103c9565b6040516101f09190610e0c565b348015610230575f5ffd5b5061024461023f366004610e35565b610452565b6040516101f0929190610e5f565b34801561025d575f5ffd5b506101c661026c366004610d11565b61048e565b34801561027c575f5ffd5b506101c661028b366004610ec1565b6106d4565b34801561029b575f5ffd5b506f71727de22e5e9d8baf0edac6f37da0326101dc565b3480156102bd575f5ffd5b506102446102cc366004610e35565b6106e4565b3480156102dc575f5ffd5b506103566102eb366004610f41565b6040805180820182525f80825260209182018190526001600160e01b03199390931683525f51602061124f5f395f51905f528152918190208151808301909252546001600160a01b0381168252600160a01b900460f81b6001600160f81b0319169181019190915290565b6040805182516001600160a01b031681526020928301516001600160f81b03191692810192909252016101f0565b6001600160f81b0319828116908216145b92915050565b5f6103c47f36e05829dd1b9a4411d96a3549582172d7f071c1c0db5c573fcf94eb284316085490565b905090565b606030306001600160a01b031663642219af8a8a8a8a8a8a8a6040516024016103f89796959493929190611071565b604051602081830303815290604052915060e01b6020820180516001600160e01b0383818316178352505050506040516020016104369291906110ce565b6040516020818303038152906040529050979650505050505050565b60605f7ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea0261048181868661070f565b92509250505b9250929050565b5f5b8681101561050c576105048888838181106104ad576104ad6110f9565b90506020028101906104bf919061110d565b6104cd90602081019061112b565b8989848181106104df576104df6110f9565b90506020028101906104f1919061110d565b6104ff906020810190611146565b6108b7565b600101610490565b505f5b848110156105cc575f86868381811061052a5761052a6110f9565b905060200281019061053c919061110d565b61054a90602081019061112b565b6001600160a01b0316146105c4576105c486868381811061056d5761056d6110f9565b905060200281019061057f919061110d565b61058d90602081019061112b565b87878481811061059f5761059f6110f9565b90506020028101906105b1919061110d565b6105bf906020810190611146565b610939565b60010161050f565b505f6105db602085018561112b565b6001600160a01b03161461060b5761060b6105f9602085018561112b565b6106066020860186611146565b610964565b5f5b818110156106ca575f838383818110610628576106286110f9565b905060200281019061063a919061110d565b61064890602081019061112b565b6001600160a01b0316146106c2576106c283838381811061066b5761066b6110f9565b905060200281019061067d919061110d565b61068b90602081019061112b565b84848481811061069d5761069d6110f9565b90506020028101906106af919061110d565b6106bd906020810190611146565b6109ea565b60010161060d565b5050505050505050565b6106df8383836108b7565b505050565b60605f7ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea036104818186865b60605f6001600160a01b03841660011480159061073357506107318585610b90565b155b1561075c57604051637c84ecfb60e01b81526001600160a01b0385166004820152602401610113565b825f0361077c5760405163f725081760e01b815260040160405180910390fd5b8267ffffffffffffffff81111561079557610795611189565b6040519080825280602002602001820160405280156107be578160200160208202803683370190505b506001600160a01b038086165f90815260208890526040812054929450911691505b6001600160a01b0382161580159061080257506001600160a01b038216600114155b801561080d57508381105b156108665781838281518110610825576108256110f9565b6001600160a01b039283166020918202929092018101919091529281165f90815292879052604090922054909116908061085e816111b1565b9150506107e0565b6001600160a01b03821660011480159061087f57505f81115b156108ab57826108906001836111c9565b815181106108a0576108a06110f9565b602002602001015191505b80835250935093915050565b7ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea026108e28185610bca565b6040516306d61fe760e41b81526001600160a01b03851690636d61fe709061091090869086906004016111dc565b5f604051808303815f87803b158015610927575f5ffd5b505af11580156106ca573d5f5f3e3d5ffd5b7ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea036108e28185610bca565b5f61098d7f36e05829dd1b9a4411d96a3549582172d7f071c1c0db5c573fcf94eb284316085490565b90506001600160a01b038116156109c25760405163741cbe0360e01b81526001600160a01b0382166004820152602401610113565b6108e2847f36e05829dd1b9a4411d96a3549582172d7f071c1c0db5c573fcf94eb2843160855565b5f6109f860048284866111ef565b610a0191611216565b90505f83836004818110610a1757610a176110f9565b909101356001600160f81b03191691505f9050610a3784600581886111ef565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284375f92019190915250929350610a799250859150610c9e9050565b15610ac65760405162461bcd60e51b815260206004820152601e60248201527f46756e6374696f6e2073656c6563746f7220616c7265616479207573656400006044820152606401610113565b6040805180820182526001600160a01b038881168083526001600160f81b0319861660208085019182526001600160e01b031989165f9081525f51602061124f5f395f51905f5290915285902093518454915160f81c600160a01b026001600160a81b03199092169316929092179190911790915590516306d61fe760e41b8152636d61fe7090610b5b908490600401610e0c565b5f604051808303815f87803b158015610b72575f5ffd5b505af1158015610b84573d5f5f3e3d5ffd5b50505050505050505050565b5f60016001600160a01b03831614801590610bc357506001600160a01b038281165f908152602085905260409020541615155b9392505050565b6001600160a01b0381161580610be957506001600160a01b0381166001145b15610c1257604051637c84ecfb60e01b81526001600160a01b0382166004820152602401610113565b6001600160a01b038181165f908152602084905260409020541615610c5557604051631034f46960e21b81526001600160a01b0382166004820152602401610113565b60015f818152602093909352604080842080546001600160a01b039485168087529286208054959091166001600160a01b03199586161790559190935280549091169091179055565b6001600160e01b0319165f9081525f51602061124f5f395f51905f5260205260409020546001600160a01b0316151590565b5f5f83601f840112610ce0575f5ffd5b50813567ffffffffffffffff811115610cf7575f5ffd5b6020830191508360208260051b8501011115610487575f5ffd5b5f5f5f5f5f5f5f6080888a031215610d27575f5ffd5b873567ffffffffffffffff811115610d3d575f5ffd5b610d498a828b01610cd0565b909850965050602088013567ffffffffffffffff811115610d68575f5ffd5b610d748a828b01610cd0565b909650945050604088013567ffffffffffffffff811115610d93575f5ffd5b88016040818b031215610da4575f5ffd5b9250606088013567ffffffffffffffff811115610dbf575f5ffd5b610dcb8a828b01610cd0565b989b979a50959850939692959293505050565b5f81518084528060208401602086015e5f602082860101526020601f19601f83011685010191505092915050565b602081525f610bc36020830184610dde565b6001600160a01b0381168114610e32575f5ffd5b50565b5f5f60408385031215610e46575f5ffd5b8235610e5181610e1e565b946020939093013593505050565b604080825283519082018190525f9060208501906060840190835b81811015610ea15783516001600160a01b0316835260209384019390920191600101610e7a565b50506001600160a01b039490941660209390930192909252509092915050565b5f5f5f60408486031215610ed3575f5ffd5b8335610ede81610e1e565b9250602084013567ffffffffffffffff811115610ef9575f5ffd5b8401601f81018613610f09575f5ffd5b803567ffffffffffffffff811115610f1f575f5ffd5b866020828401011115610f30575f5ffd5b939660209190910195509293505050565b5f60208284031215610f51575f5ffd5b81356001600160e01b031981168114610bc3575f5ffd5b81835281816020850137505f828201602090810191909152601f909101601f19169091010190565b5f8135610f9c81610e1e565b6001600160a01b03168352602082013536839003601e19018112610fbe575f5ffd5b820160208101903567ffffffffffffffff811115610fda575f5ffd5b803603821315610fe8575f5ffd5b60406020860152610ffd604086018284610f68565b95945050505050565b5f8383855260208501945060208460051b820101835f5b8681101561106557838303601f19018852813536879003603e19018112611042575f5ffd5b61104e84888301610f90565b6020998a019990945092909201915060010161101d565b50909695505050505050565b608081525f61108460808301898b611006565b828103602084015261109781888a611006565b905082810360408401526110ab8187610f90565b905082810360608401526110c0818587611006565b9a9950505050505050505050565b6001600160a01b03831681526040602082018190525f906110f190830184610dde565b949350505050565b634e487b7160e01b5f52603260045260245ffd5b5f8235603e19833603018112611121575f5ffd5b9190910192915050565b5f6020828403121561113b575f5ffd5b8135610bc381610e1e565b5f5f8335601e1984360301811261115b575f5ffd5b83018035915067ffffffffffffffff821115611175575f5ffd5b602001915036819003821315610487575f5ffd5b634e487b7160e01b5f52604160045260245ffd5b634e487b7160e01b5f52601160045260245ffd5b5f600182016111c2576111c261119d565b5060010190565b818103818111156103955761039561119d565b602081525f6110f1602083018486610f68565b5f5f858511156111fd575f5ffd5b83861115611209575f5ffd5b5050820193919092039150565b80356001600160e01b03198116906004841015611247576001600160e01b0319600485900360031b81901b82161691505b509291505056fef88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea04a26469706673582212207f8df2c19a2c8e169be0659188dfe64559741fb2ca38b30f93836a17f2cbc4e764736f6c634300081b0033";
    bytes constant ERC7579_RHINESTONE_TRAMPOLOINE_BYTECODE =
        hex"6080604052348015600e575f5ffd5b5061081d8061001c5f395ff3fe608060405260043610610058575f3560e01c80630a664dba146101b55780635faac46b146101e6578063b0d691fe14610213578063e1c7392a14610235578063ea5f61d014610249578063eac9b20d146102685761005f565b3661005f57005b5f3560e01c63bc197c81811463f23a6e6182141763150b7a028214171561008a57806020526020603cf35b505f80356001600160e01b03191681527ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea046020526040902080546001600160a01b03811690600160a01b900460f81b8161010957604051632464e76d60e11b81526001600160e01b03195f351660048201526024015b60405180910390fd5b61011781607f60f91b61032e565b156101685760408051368101909152365f823760408051601481019091523360601b90525f803660140183865afa90506101573d60408051918201905290565b3d5f823e81610164573d81fd5b3d81f35b610172815f61032e565b156101b35760408051368101909152365f823760408051601481019091523360601b90525f80366014018382875af190506101573d60408051918201905290565b005b3480156101c0575f5ffd5b506101c9610345565b6040516001600160a01b0390911681526020015b60405180910390f35b3480156101f1575f5ffd5b5061020561020036600461068d565b610373565b6040516101dd9291906106c2565b34801561021e575f5ffd5b506f71727de22e5e9d8baf0edac6f37da0326101c9565b348015610240575f5ffd5b506101b36103ae565b348015610254575f5ffd5b5061020561026336600461068d565b610480565b348015610273575f5ffd5b50610300610282366004610724565b6040805180820182525f80825260209182018190526001600160e01b03199390931683527ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea048152918190208151808301909252546001600160a01b0381168252600160a01b900460f81b6001600160f81b0319169181019190915290565b6040805182516001600160a01b031681526020928301516001600160f81b03191692810192909252016101dd565b6001600160f81b0319828116908216145b92915050565b5f61036e7f36e05829dd1b9a4411d96a3549582172d7f071c1c0db5c573fcf94eb284316085490565b905090565b60605f7ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea026103a28186866104ab565b92509250509250929050565b6103ea7334dedac925c00d63bd91800ff821e535fe59d6f57f36e05829dd1b9a4411d96a3549582172d7f071c1c0db5c573fcf94eb2843160855565b60408051737066f491ce8b5f782f315dfbd549f2107a32641360611b60208201528151601481830301815260348201928390526306d61fe760e41b9092527334dedac925c00d63bd91800ff821e535fe59d6f591636d61fe7091610451919060380161074b565b5f604051808303815f87803b158015610468575f5ffd5b505af115801561047a573d5f5f3e3d5ffd5b50505050565b60605f7ff88ce1fdb7fb1cbd3282e49729100fa3f2d6ee9f797961fe4fb1871cea89ea036103a28186865b60605f6001600160a01b0384166001148015906104cf57506104cd8585610653565b155b156104f857604051637c84ecfb60e01b81526001600160a01b0385166004820152602401610100565b825f036105185760405163f725081760e01b815260040160405180910390fd5b8267ffffffffffffffff81111561053157610531610780565b60405190808252806020026020018201604052801561055a578160200160208202803683370190505b506001600160a01b038086165f90815260208890526040812054929450911691505b6001600160a01b0382161580159061059e57506001600160a01b038216600114155b80156105a957508381105b1561060257818382815181106105c1576105c1610794565b6001600160a01b039283166020918202929092018101919091529281165f9081529287905260409092205490911690806105fa816107bc565b91505061057c565b6001600160a01b03821660011480159061061b57505f81115b15610647578261062c6001836107d4565b8151811061063c5761063c610794565b602002602001015191505b80835250935093915050565b5f60016001600160a01b0383161480159061068657506001600160a01b038281165f908152602085905260409020541615155b9392505050565b5f5f6040838503121561069e575f5ffd5b82356001600160a01b03811681146106b4575f5ffd5b946020939093013593505050565b604080825283519082018190525f9060208501906060840190835b818110156107045783516001600160a01b03168352602093840193909201916001016106dd565b50506001600160a01b039490941660209390930192909252509092915050565b5f60208284031215610734575f5ffd5b81356001600160e01b031981168114610686575f5ffd5b602081525f82518060208401528060208501604085015e5f604082850101526040601f19601f83011684010191505092915050565b634e487b7160e01b5f52604160045260245ffd5b634e487b7160e01b5f52603260045260245ffd5b634e487b7160e01b5f52601160045260245ffd5b5f600182016107cd576107cd6107a8565b5060010190565b8181038181111561033f5761033f6107a856fea26469706673582212208b8d179eb9f1d514092184d86650903af803b01f367d0d2440620538d93230ac64736f6c634300081b0033";
}
